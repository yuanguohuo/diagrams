<mxfile host="app.diagrams.net" modified="2024-01-19T10:45:18.713Z" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" version="22.1.16" etag="myM7RjMsX1ocBoksT0Ez" type="device" pages="3">
  <diagram id="jbke2ZCyE3dg-BNAuTJv" name="x64-calling-convention">
    <mxGraphModel dx="2074" dy="1121" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="2CNJP_l4lLsxfeqXhCe6-2" value="&lt;font face=&quot;Verdana&quot; style=&quot;font-size: 14px;&quot;&gt;X86 32位架构&lt;br&gt;&lt;br&gt;&lt;/font&gt;&lt;div style=&quot;text-align: left; font-size: 14px; line-height: 140%;&quot;&gt;&lt;font face=&quot;GoLRnlrtvAi4eT-EK6b2&quot; style=&quot;font-size: 14px;&quot;&gt;X86 32位架构有多种calling convention:&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left; font-size: 14px; line-height: 140%;&quot;&gt;&lt;ol style=&quot;line-height: 140%;&quot;&gt;&lt;li style=&quot;&quot;&gt;&lt;font face=&quot;GoLRnlrtvAi4eT-EK6b2&quot; style=&quot;font-size: 14px;&quot;&gt;Caller clean-up: the caller cleans the arguments from the stack (resets the state of the stack just as it was before the callee function was called).&lt;/font&gt;&lt;/li&gt;&lt;ul style=&quot;line-height: 140%;&quot;&gt;&lt;li&gt;&lt;font face=&quot;GoLRnlrtvAi4eT-EK6b2&quot; style=&quot;font-size: 14px;&quot;&gt;cdecl (Unix-like, GCC)&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;GoLRnlrtvAi4eT-EK6b2&quot; style=&quot;font-size: 14px;&quot;&gt;cdecl (Microsoft)&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;GoLRnlrtvAi4eT-EK6b2&quot; style=&quot;font-size: 14px;&quot;&gt;syscall&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;GoLRnlrtvAi4eT-EK6b2&quot; style=&quot;font-size: 14px;&quot;&gt;optlink&lt;/font&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font face=&quot;GoLRnlrtvAi4eT-EK6b2&quot; style=&quot;font-size: 14px;&quot;&gt;Callee clean-up: the callee cleans up the arguments from the stack.&lt;/font&gt;&lt;/span&gt;&lt;/li&gt;&lt;ul style=&quot;line-height: 140%;&quot;&gt;&lt;li&gt;&lt;font face=&quot;GoLRnlrtvAi4eT-EK6b2&quot; style=&quot;font-size: 14px;&quot;&gt;pascal&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;GoLRnlrtvAi4eT-EK6b2&quot; style=&quot;font-size: 14px;&quot;&gt;stdcall&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;GoLRnlrtvAi4eT-EK6b2&quot; style=&quot;font-size: 14px;&quot;&gt;Microsoft fastcall&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;GoLRnlrtvAi4eT-EK6b2&quot; style=&quot;font-size: 14px;&quot;&gt;Microsoft vectorcall&lt;/font&gt;&lt;/li&gt;&lt;/ul&gt;&lt;li style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font face=&quot;GoLRnlrtvAi4eT-EK6b2&quot; style=&quot;font-size: 14px;&quot;&gt;Either caller or callee clean-up:&lt;/font&gt;&lt;/span&gt;&lt;/li&gt;&lt;ul style=&quot;line-height: 140%;&quot;&gt;&lt;li style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font face=&quot;GoLRnlrtvAi4eT-EK6b2&quot; style=&quot;font-size: 14px;&quot;&gt;thiscall&lt;/font&gt;&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/ol&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fillColor=#cce5ff;strokeColor=none;spacingLeft=10;spacingRight=10;" vertex="1" parent="1">
          <mxGeometry x="45" y="30" width="755" height="360" as="geometry" />
        </mxCell>
        <mxCell id="8LLDqWOe1i28gj5ynCJR-1" value="&lt;div style=&quot;line-height: 140%; font-size: 14px;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;X86-64架构&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left; line-height: 140%; font-size: 14px;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;&amp;nbsp;X86-64 位架构只有2种calling convention:&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left; line-height: 140%; font-size: 14px;&quot;&gt;&lt;ol style=&quot;line-height: 140%;&quot;&gt;&lt;li style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;Microsoft x64 calling convention:&lt;/font&gt;&lt;/li&gt;&lt;li style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;System V AMD64 ABI: followed on Solaris, Linux, FreeBSD, macOS,[26] and is the de facto standard among Unix and Unix-like operating systems.&lt;/font&gt;&lt;/li&gt;&lt;ul style=&quot;line-height: 140%;&quot;&gt;&lt;li style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;前6个整数或指针参数通过寄存器传递: RDI, RSI, RDX, RCX, R8, R9.&lt;/font&gt;&lt;/span&gt;&lt;/li&gt;&lt;li style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;前8个浮点参数通过寄存器传递：XMM0, XMM1, XMM2, XMM3, XMM4, XMM5, XMM6, XMM7.&lt;/font&gt;&lt;/li&gt;&lt;li style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;这6个整数或指针以及8个浮点可以随意排序（不必前6个是整数或指针，接着8个浮点）&lt;/font&gt;&lt;/li&gt;&lt;li style=&quot;&quot;&gt;也就是说，可以通过寄存器器传递14个参数；大多数函数应该都够了。&lt;/li&gt;&lt;li style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;假如还有更多的参数，则通过栈传递。&lt;/font&gt;&lt;/li&gt;&lt;li style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;16个字节以内的整数或指针通过RAX和RDX返回。注意：16字节以内的struct也是通过这2个寄存器返回的，只要它的成员变量是整数或指针。&lt;/font&gt;&lt;/li&gt;&lt;li style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;32个字节以内的浮点通过XMM0和XMM1返回。注意：32字节以内的struct也是通过这2个寄存器返回的，只要它的成员变量是浮点。&lt;/font&gt;&lt;/li&gt;&lt;li style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;若要返回一个大的struct：caller准备空间，并且把空间的指针作为第1个参数传入(其他参数向右移)；并且返回时，RAX存的是这个指针。&lt;/font&gt;&lt;/li&gt;&lt;li style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;If the callee wishes to use registers RBX, RSP, RBP, and R12–R15, it must restore their original values before returning control to the caller. 当然callee要先保存它们，否则何以恢复呢。&lt;/font&gt;&lt;/li&gt;&lt;li style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;All other registers must be saved by the caller if it wishes to preserve their values. 也就是说，callee可以自由使用不用save/restore，由caller负责。&lt;/font&gt;&lt;/li&gt;&lt;li style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;对于leaf-functions，从RSP往下128字节叫做red-zone. 当RSP变化(push/pop)时，red-zone也相应上下移动。假如leaf-function用的栈比较少(小于128字节)，编译器可以这样优化函数：RSP不变（也不用push %rbp, mov %rsp %rbp），使用栈空间时，直接根据固定的RSP来计算即可，不必leaq -4(%rsp) %rsp，因为不再调用别的函数了，当前函数搞清空间和地址就行了。并且，this zone will not be clobbered by any signal or interrupt handlers.&lt;/font&gt;&lt;/li&gt;&lt;li style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;On function entry, the return address is adjacent to the seventh (前6个通过寄存器传递) integer argument on the stack.&lt;/font&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/ol&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=none;spacingLeft=10;spacingRight=10;" vertex="1" parent="1">
          <mxGeometry x="45" y="410" width="755" height="620" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="Eh8paahVvG9QLfNbAdsy" name="boost-1.84-context">
    <mxGraphModel dx="1827" dy="566" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="GGpoX9My9VvDshcc4II9-1" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#eeeeee;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-720" y="60" width="1250" height="960" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-2" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;make_fcontext(top_of_context_stack, stack_size, func_ptr)&lt;br&gt;&lt;br&gt;arg1: rdi&lt;br&gt;arg2: rsi&lt;br&gt;arg3: rdx&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-210" y="90" width="400" height="80" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-6" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-210" y="210" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-7" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;RIP:&amp;nbsp; &amp;nbsp; 0x40-0x48&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="120" y="215" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-8" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-210" y="490" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-9" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;guard:&amp;nbsp; &amp;nbsp; 0x08-0x10&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="120" y="495" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-10" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-210" y="450" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-11" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R12:&amp;nbsp; &amp;nbsp; 0x10-0x18&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="120" y="455" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-12" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-210" y="410" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-13" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R13:&amp;nbsp; &amp;nbsp; 0x18-0x20&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="120" y="415" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-14" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-210" y="370" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-15" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R14:&amp;nbsp; &amp;nbsp; 0x20-0x28&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="120" y="375" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-16" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-210" y="330" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-17" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R15:&amp;nbsp; &amp;nbsp; 0x28-0x30&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="120" y="335" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-18" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;func_ptr&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-210" y="290" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-19" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;RBX:&amp;nbsp; &amp;nbsp; 0x30-0x38&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="120" y="295" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-20" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-210" y="250" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-21" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;RBP:&amp;nbsp; &amp;nbsp; 0x38-0x40&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="120" y="255" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-22" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-210" y="530" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-23" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;fc_mxcsr:&amp;nbsp; 0x00-0x04&amp;nbsp; &amp;nbsp; fc_x87_cw: 0x04-0x08&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="120" y="535" width="290" height="30" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-24" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-50" y="530" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-26" value="" style="endArrow=classic;html=1;rounded=0;entryX=1;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="430" y="200" as="sourcePoint" />
            <mxPoint x="110" y="200" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-27" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;rdi&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="440" y="185" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-29" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#B3B3B3;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-210" y="570" width="320" height="400" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-33" value="" style="endArrow=classic;html=1;rounded=0;entryX=1;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" target="4Ub3L_lISXtPxaciS0P6-29">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="470" y="970" as="sourcePoint" />
            <mxPoint x="80" y="490" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-34" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="390" y="560" as="sourcePoint" />
            <mxPoint x="390" y="200" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-35" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="390" y="610" as="sourcePoint" />
            <mxPoint x="390" y="970" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-36" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;rsi&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="380" y="570" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-37" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-280" y="570" as="sourcePoint" />
            <mxPoint x="-220" y="570" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-38" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;return value&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-280" y="580" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-40" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;trampoline:&lt;br&gt;&amp;nbsp; &amp;nbsp; push %rbp&lt;br&gt;&amp;nbsp; &amp;nbsp; jmp *%rbx&amp;nbsp; &amp;nbsp; /*jump to func_ptr*/&lt;br&gt;&lt;/font&gt;" style="shape=ext;double=1;rounded=0;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="-700" y="650" width="230" height="90" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-41" value="" style="endArrow=classic;html=1;rounded=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;edgeStyle=orthogonalEdgeStyle;curved=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="4Ub3L_lISXtPxaciS0P6-6" target="4Ub3L_lISXtPxaciS0P6-40">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-275" y="440" as="sourcePoint" />
            <mxPoint x="-385" y="550" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-42" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;finish:&lt;br&gt;&amp;nbsp; &amp;nbsp; xorq&amp;nbsp; %rdi, %rdi&lt;br&gt;&amp;nbsp; &amp;nbsp; call&amp;nbsp; _exit@PLT&lt;br&gt;&amp;nbsp; &amp;nbsp; hlt&lt;br&gt;&lt;/font&gt;" style="shape=ext;double=1;rounded=0;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="-460" y="650" width="230" height="90" as="geometry" />
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-43" value="" style="endArrow=classic;html=1;rounded=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;edgeStyle=orthogonalEdgeStyle;curved=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="4Ub3L_lISXtPxaciS0P6-20" target="4Ub3L_lISXtPxaciS0P6-42">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-200" y="560" as="sourcePoint" />
            <mxPoint x="-355" y="660" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="4Ub3L_lISXtPxaciS0P6-45" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#B3B3B3;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-210" y="200" width="320" height="10" as="geometry" />
        </mxCell>
        <mxCell id="xexhbgqQ1-xzwzm1V1U8-1" value="&lt;div&gt;&lt;span style=&quot;background-color: initial; font-family: &amp;quot;Comic Sans MS&amp;quot;;&quot;&gt;调用jump_fcontext时，在caller的栈上产生fcontext：&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;ul&gt;&lt;li&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;call指令push ret-address，然后jmp到jump_fcontext函数;&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;在此函数中，leaq&amp;nbsp; -0x40(%rsp), %rsp;&amp;nbsp; rsp减0x40，然后保存寄存器。为什么不是减0x48呢？因为push ret-address已经产生了8字节的RIP；&lt;/span&gt;&lt;/li&gt;&lt;li&gt;caller的jump_fcontext函数返回时(其实是callee通过另一次jump_fcontext跳回caller)，从ret-address开始执行，即前面push的下一条指令地址。&lt;/li&gt;&lt;/ul&gt;&lt;div&gt;make_fcontext直接产生的fcontext:&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;ul&gt;&lt;li&gt;第一次跳到coroutine时，从栈上恢复寄存器：RBP=finish; RBX=user function; RIP=trampoline;&lt;/li&gt;&lt;li&gt;也就是说，第一次跳到coroutine时，从trampoline开始执行。&lt;/li&gt;&lt;li&gt;trampoline: push RBP然后jmp RBX；这等价于call指令：push返回地址finish，jump到user function。&lt;/li&gt;&lt;li&gt;所以，user function返回时，是返回到finish。&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&lt;font face=&quot;DZygLhT-5cj6kaiBZgEZ&quot;&gt;&lt;br&gt;&lt;/font&gt;所以，make_fcontext和jump_fcontext的上半段做的事情是一样的。&lt;font face=&quot;DZygLhT-5cj6kaiBZgEZ&quot;&gt;&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=#a0522d;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="-285" y="1070" width="470" height="350" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="HEkmP1sWNCJl-5iC1i9G" name="jump">
    <mxGraphModel dx="2924" dy="1121" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="Eoj1K-aATxveumdk1Mle-9" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#eeeeee;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-310" y="3910" width="2110" height="887" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-91" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#B3B3B3;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="13" y="4030" width="320" height="100" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-201" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#eeeeee;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-330" y="2650" width="2110" height="887" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-200" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#eeeeee;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-360" y="1340" width="2110" height="910" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-199" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#eeeeee;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-360" y="40" width="2110" height="960" as="geometry" />
        </mxCell>
        <mxCell id="YXSDdIa4yUSR-eO04FzJ-1" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;main的下一条指令地址&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffcc99;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-17" y="202" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YXSDdIa4yUSR-eO04FzJ-2" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;RIP:&amp;nbsp; &amp;nbsp; 0x40-0x48&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="313" y="207" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="YXSDdIa4yUSR-eO04FzJ-3" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-17" y="482" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YXSDdIa4yUSR-eO04FzJ-4" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;guard:&amp;nbsp; &amp;nbsp; 0x08-0x10&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="313" y="487" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="YXSDdIa4yUSR-eO04FzJ-5" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-17" y="442" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YXSDdIa4yUSR-eO04FzJ-6" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R12:&amp;nbsp; &amp;nbsp; 0x10-0x18&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="313" y="447" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="YXSDdIa4yUSR-eO04FzJ-7" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-17" y="402" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YXSDdIa4yUSR-eO04FzJ-8" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R13:&amp;nbsp; &amp;nbsp; 0x18-0x20&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="313" y="407" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="YXSDdIa4yUSR-eO04FzJ-9" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-17" y="362" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YXSDdIa4yUSR-eO04FzJ-10" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R14:&amp;nbsp; &amp;nbsp; 0x20-0x28&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="313" y="367" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="YXSDdIa4yUSR-eO04FzJ-11" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-17" y="322" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YXSDdIa4yUSR-eO04FzJ-12" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R15:&amp;nbsp; &amp;nbsp; 0x28-0x30&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="313" y="327" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="YXSDdIa4yUSR-eO04FzJ-13" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;func_ptr&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-17" y="282" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YXSDdIa4yUSR-eO04FzJ-14" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;RBX:&amp;nbsp; &amp;nbsp; 0x30-0x38&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="313" y="287" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="YXSDdIa4yUSR-eO04FzJ-15" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-17" y="242" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YXSDdIa4yUSR-eO04FzJ-16" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;RBP:&amp;nbsp; &amp;nbsp; 0x38-0x40&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="313" y="247" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="YXSDdIa4yUSR-eO04FzJ-17" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-17" y="522" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="YXSDdIa4yUSR-eO04FzJ-18" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;fc_mxcsr:&amp;nbsp; 0x00-0x04&amp;nbsp; &amp;nbsp; fc_x87_cw: 0x04-0x08&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="313" y="527" width="290" height="30" as="geometry" />
        </mxCell>
        <mxCell id="YXSDdIa4yUSR-eO04FzJ-19" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="143" y="522" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="nEDeLluRAmkBdulKXoaj-1" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;调用jump_fcontext时，call指令push RIP&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-270" y="202" width="230" height="40" as="geometry" />
        </mxCell>
        <mxCell id="nEDeLluRAmkBdulKXoaj-3" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;jump_fcontext函数内保存寄存器，在main的栈上&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-310" y="387" width="290" height="30" as="geometry" />
        </mxCell>
        <mxCell id="nEDeLluRAmkBdulKXoaj-6" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;labelPosition=left;verticalLabelPosition=middle;align=right;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="-40" y="242" width="20" height="320" as="geometry" />
        </mxCell>
        <mxCell id="nEDeLluRAmkBdulKXoaj-7" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;labelPosition=left;verticalLabelPosition=middle;align=right;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="-40" y="202" width="20" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Ociups9EeUmTzE3S7yvl-1" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;jump_fcontext(to_ctx, user_data)&lt;br&gt;&lt;br&gt;arg1: rdi&lt;br&gt;arg2: rsi&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-17" y="92" width="400" height="80" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-2" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1020" y="172" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-3" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;RIP:&amp;nbsp; &amp;nbsp; 0x40-0x48&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1350" y="177" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-4" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1020" y="452" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-5" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;guard:&amp;nbsp; &amp;nbsp; 0x08-0x10&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1350" y="457" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-6" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1020" y="412" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-7" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R12:&amp;nbsp; &amp;nbsp; 0x10-0x18&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1350" y="417" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-8" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1020" y="372" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-9" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R13:&amp;nbsp; &amp;nbsp; 0x18-0x20&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1350" y="377" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-10" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1020" y="332" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-11" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R14:&amp;nbsp; &amp;nbsp; 0x20-0x28&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1350" y="337" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-12" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1020" y="292" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-13" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R15:&amp;nbsp; &amp;nbsp; 0x28-0x30&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1350" y="297" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-14" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;func_ptr&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1020" y="252" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-15" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;RBX:&amp;nbsp; &amp;nbsp; 0x30-0x38&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1350" y="257" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-16" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1020" y="212" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-17" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;RBP:&amp;nbsp; &amp;nbsp; 0x38-0x40&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1350" y="217" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-18" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1020" y="492" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-19" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;fc_mxcsr:&amp;nbsp; 0x00-0x04&amp;nbsp; &amp;nbsp; fc_x87_cw: 0x04-0x08&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1350" y="497" width="290" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-20" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1180" y="492" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-21" value="" style="endArrow=classic;html=1;rounded=0;entryX=1;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1660" y="162" as="sourcePoint" />
            <mxPoint x="1340" y="162" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-22" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;rdi&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1670" y="147" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-23" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#B3B3B3;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="1020" y="532" width="320" height="400" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-24" value="" style="endArrow=classic;html=1;rounded=0;entryX=1;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" target="KbAcV0jcCkFXwa1uhN9h-23">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1700" y="932" as="sourcePoint" />
            <mxPoint x="1310" y="452" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-25" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1620" y="522" as="sourcePoint" />
            <mxPoint x="1620" y="162" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-26" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1620" y="572" as="sourcePoint" />
            <mxPoint x="1620" y="932" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-27" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;rsi&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1610" y="532" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-29" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;return value&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="950" y="542" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-30" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;trampoline:&lt;br&gt;&amp;nbsp; &amp;nbsp; push %rbp&lt;br&gt;&amp;nbsp; &amp;nbsp; jmp *%rbx&amp;nbsp; &amp;nbsp; /*jump to func_ptr*/&lt;br&gt;&lt;/font&gt;" style="shape=ext;double=1;rounded=0;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="530" y="612" width="230" height="90" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-31" value="" style="endArrow=classic;html=1;rounded=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;edgeStyle=orthogonalEdgeStyle;curved=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="KbAcV0jcCkFXwa1uhN9h-2" target="KbAcV0jcCkFXwa1uhN9h-30">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="955" y="402" as="sourcePoint" />
            <mxPoint x="845" y="512" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-32" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;finish:&lt;br&gt;&amp;nbsp; &amp;nbsp; xorq&amp;nbsp; %rdi, %rdi&lt;br&gt;&amp;nbsp; &amp;nbsp; call&amp;nbsp; _exit@PLT&lt;br&gt;&amp;nbsp; &amp;nbsp; hlt&lt;br&gt;&lt;/font&gt;" style="shape=ext;double=1;rounded=0;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="770" y="612" width="230" height="90" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-33" value="" style="endArrow=classic;html=1;rounded=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;edgeStyle=orthogonalEdgeStyle;curved=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="KbAcV0jcCkFXwa1uhN9h-16" target="KbAcV0jcCkFXwa1uhN9h-32">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1030" y="522" as="sourcePoint" />
            <mxPoint x="875" y="622" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-34" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#B3B3B3;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="1020" y="162" width="320" height="10" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-35" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=0;edgeStyle=orthogonalEdgeStyle;curved=1;dashed=1;" edge="1" parent="1" target="KbAcV0jcCkFXwa1uhN9h-23">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="60" y="141" as="sourcePoint" />
            <mxPoint x="570" y="510" as="targetPoint" />
            <Array as="points">
              <mxPoint x="40" y="140" />
              <mxPoint x="40" y="141" />
              <mxPoint x="590" y="141" />
              <mxPoint x="590" y="532" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-36" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;main的下一条指令地址&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffcc99;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-27" y="1460" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-37" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;RIP:&amp;nbsp; &amp;nbsp; 0x40-0x48&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="303" y="1465" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-38" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-27" y="1740" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-39" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;guard:&amp;nbsp; &amp;nbsp; 0x08-0x10&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="303" y="1745" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-40" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-27" y="1700" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-41" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R12:&amp;nbsp; &amp;nbsp; 0x10-0x18&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="303" y="1705" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-42" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-27" y="1660" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-43" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R13:&amp;nbsp; &amp;nbsp; 0x18-0x20&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="303" y="1665" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-44" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-27" y="1620" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-45" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R14:&amp;nbsp; &amp;nbsp; 0x20-0x28&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="303" y="1625" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-46" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-27" y="1580" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-47" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R15:&amp;nbsp; &amp;nbsp; 0x28-0x30&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="303" y="1585" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-48" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;func_ptr&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-27" y="1540" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-49" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;RBX:&amp;nbsp; &amp;nbsp; 0x30-0x38&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="303" y="1545" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-50" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-27" y="1500" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-51" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;RBP:&amp;nbsp; &amp;nbsp; 0x38-0x40&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="303" y="1505" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-52" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-27" y="1780" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-53" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;fc_mxcsr:&amp;nbsp; 0x00-0x04&amp;nbsp; &amp;nbsp; fc_x87_cw: 0x04-0x08&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="303" y="1785" width="290" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-54" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="133" y="1780" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-55" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;调用jump_fcontext时，call指令push RIP&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-280" y="1460" width="230" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-56" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;jump_fcontext函数内保存寄存器，在main的栈上&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-320" y="1645" width="290" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-57" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;labelPosition=left;verticalLabelPosition=middle;align=right;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="-50" y="1500" width="20" height="320" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-58" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;labelPosition=left;verticalLabelPosition=middle;align=right;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="-50" y="1460" width="20" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-59" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;jump_fcontext(to_ctx, main的user_data)&lt;br&gt;&lt;br&gt;arg1: rdi&lt;br&gt;arg2: rsi&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-27" y="1350" width="400" height="80" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-81" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#B3B3B3;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="1010" y="1430" width="320" height="760" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-87" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;trampoline:&lt;br&gt;&amp;nbsp; &amp;nbsp; push %rbp&lt;br&gt;&amp;nbsp; &amp;nbsp; jmp *%rbx&amp;nbsp; &amp;nbsp; /*jump to func_ptr*/&lt;br&gt;&lt;/font&gt;" style="shape=ext;double=1;rounded=0;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="520" y="1870" width="230" height="90" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-88" value="" style="endArrow=classic;html=1;rounded=0;edgeStyle=orthogonalEdgeStyle;curved=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="KbAcV0jcCkFXwa1uhN9h-95" target="KbAcV0jcCkFXwa1uhN9h-87">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="635" y="1760" as="sourcePoint" />
            <mxPoint x="835" y="1770" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-89" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;finish:&lt;br&gt;&amp;nbsp; &amp;nbsp; xorq&amp;nbsp; %rdi, %rdi&lt;br&gt;&amp;nbsp; &amp;nbsp; call&amp;nbsp; _exit@PLT&lt;br&gt;&amp;nbsp; &amp;nbsp; hlt&lt;br&gt;&lt;/font&gt;" style="shape=ext;double=1;rounded=0;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="760" y="1870" width="230" height="90" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-90" value="" style="endArrow=classic;html=1;rounded=0;edgeStyle=orthogonalEdgeStyle;curved=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="Eoj1K-aATxveumdk1Mle-3" target="KbAcV0jcCkFXwa1uhN9h-89">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="875.5" y="1750" as="sourcePoint" />
            <mxPoint x="865" y="1880" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-6" value="push %rbp" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="KbAcV0jcCkFXwa1uhN9h-90">
          <mxGeometry x="0.1668" y="13" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-93" value="&lt;ol&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;movq&amp;nbsp; %rdi, %rsp；切换到coroutine的栈上；&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;DZygLhT-5cj6kaiBZgEZ&quot;&gt;movq&amp;nbsp; 0x40(%rsp), %r8；把RIP保存到r8寄存器，即trampoline的地址；&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;DZygLhT-5cj6kaiBZgEZ&quot; style=&quot;font-size: 14px;&quot;&gt;从coroutine上恢复寄存器；&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;DZygLhT-5cj6kaiBZgEZ&quot;&gt;leaq&amp;nbsp; 0x48(%rsp), %rsp；即rsp = rsp + 0x48；因为寄存器已经恢复，所以空间还给栈；&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;DZygLhT-5cj6kaiBZgEZ&quot;&gt;jmp&amp;nbsp; *%r8，即跳到trampoline；&lt;br&gt;&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;DZygLhT-5cj6kaiBZgEZ&quot;&gt;在trampoline中，push %rbp；注意rbp是从栈上恢复的，栈是make_fcontext生成的，rbp是finish的地址。所以，这里push的是finish的地址。&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;DZygLhT-5cj6kaiBZgEZ&quot;&gt;由trampoline跳到func_ptr指向的user function，入参是：&lt;/font&gt;&lt;/li&gt;&lt;ol&gt;&lt;li&gt;&lt;font face=&quot;DZygLhT-5cj6kaiBZgEZ&quot;&gt;rdi指向的main栈上的context;&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;DZygLhT-5cj6kaiBZgEZ&quot;&gt;rsi指向main的user_data;&lt;/font&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;font face=&quot;DZygLhT-5cj6kaiBZgEZ&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;6和7是push finish和jmp user-function，其实就等于一个call指令；call的函数是&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;user-function，返回地址是finish；当user-function返回后，下一跳指令在finish&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;处。&amp;nbsp;&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=#a0522d;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="453" y="1030" width="470" height="250" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-95" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;r8&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="602.5" y="1720" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-96" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;rbx: func_ptr&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="586.5" y="1990" width="97" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-98" value="&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-family: &amp;quot;Comic Sans MS&amp;quot;; background-color: initial;&quot;&gt;user function()&lt;/span&gt;&lt;/div&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;入参：&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;rdi:&amp;nbsp; main栈上的context&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;rsi:&amp;nbsp; &amp;nbsp;jump_fcontext的第2个参数&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;即main的user_data&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;" style="shape=ext;double=1;rounded=0;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="520" y="2080" width="230" height="100" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-99" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="KbAcV0jcCkFXwa1uhN9h-96" target="KbAcV0jcCkFXwa1uhN9h-98">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="620" y="1860" as="sourcePoint" />
            <mxPoint x="670" y="1810" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-100" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;rsp&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1410" y="1455" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-101" value="" style="endArrow=classic;html=1;rounded=0;entryX=1.006;entryY=0.052;entryDx=0;entryDy=0;entryPerimeter=0;exitX=0.839;exitY=0.143;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" parent="1" source="KbAcV0jcCkFXwa1uhN9h-200" target="KbAcV0jcCkFXwa1uhN9h-81">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1380" y="1480" as="sourcePoint" />
            <mxPoint x="1350" y="1470" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-103" value="" style="endArrow=classic;html=1;rounded=0;entryX=1;entryY=1;entryDx=0;entryDy=0;edgeStyle=orthogonalEdgeStyle;curved=1;" edge="1" parent="1" source="KbAcV0jcCkFXwa1uhN9h-98" target="KbAcV0jcCkFXwa1uhN9h-54">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="610" y="2140" as="sourcePoint" />
            <mxPoint x="790" y="1680" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-105" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.25;entryY=0;entryDx=0;entryDy=0;dashed=1;" edge="1" parent="1" source="KbAcV0jcCkFXwa1uhN9h-87" target="KbAcV0jcCkFXwa1uhN9h-98">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="740" y="2040" as="sourcePoint" />
            <mxPoint x="790" y="1990" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-110" value="&lt;ol&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;user_function运行一段时间，占用了一些栈空间；&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;yield，即通过jump_fcontext跳回main.&amp;nbsp;&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;jump_fcontext的入参是：&lt;/font&gt;&lt;/li&gt;&lt;ol&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;to_ctx: main栈上的context&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;user_data: coroutine的user_data&lt;/font&gt;&lt;/li&gt;&lt;/ol&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;jump_fcontext:&lt;/font&gt;&lt;/li&gt;&lt;ol&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;在coroutine的栈上建context，即保存寄存器；&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;movq&amp;nbsp; %rdi, %rsp，切回main的栈上的context；&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;movq&amp;nbsp; 0x40(%rsp), %r8，把main的下一条指令地址保存到r8;&lt;br&gt;&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;恢复寄存器；&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;leaq&amp;nbsp; 0x48(%rsp), %rsp；即rsp = rsp + 0x48；因为寄存器已经恢复，所以空间还给栈；&lt;br&gt;&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;准备返回值：rax指向coroutine栈上的context；rdx指向coroutine的user_data;&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;jmp&amp;nbsp; *%r8，即返回main的下一条指令；&lt;/font&gt;&lt;br&gt;&lt;/li&gt;&lt;/ol&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;对于main来说，&lt;/font&gt;jump_fcontext返回了（其实不是简单的一个函数调用返回，而是经过两次跳转）。返回值是(和跳入user function的入参对称)：&lt;/li&gt;&lt;ol&gt;&lt;li&gt;rax: coroutine栈上的context;&lt;/li&gt;&lt;li&gt;rdx: coroutine的user_data;&lt;/li&gt;&lt;/ol&gt;&lt;/ol&gt;" style="text;html=1;strokeColor=none;fillColor=#a0522d;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="410" y="2270" width="470" height="350" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-135" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#B3B3B3;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="1010" y="2730" width="320" height="760" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-138" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;finish:&lt;br&gt;&amp;nbsp; &amp;nbsp; xorq&amp;nbsp; %rdi, %rdi&lt;br&gt;&amp;nbsp; &amp;nbsp; call&amp;nbsp; _exit@PLT&lt;br&gt;&amp;nbsp; &amp;nbsp; hlt&lt;br&gt;&lt;/font&gt;" style="shape=ext;double=1;rounded=0;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="760" y="3141" width="230" height="90" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-139" value="" style="endArrow=classic;html=1;rounded=0;edgeStyle=orthogonalEdgeStyle;curved=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="Eoj1K-aATxveumdk1Mle-4" target="KbAcV0jcCkFXwa1uhN9h-138">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="875.5" y="3050" as="sourcePoint" />
            <mxPoint x="865" y="3180" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-151" value="" style="rounded=0;whiteSpace=wrap;html=1;fillStyle=dots;" vertex="1" parent="1">
          <mxGeometry x="1010" y="2730" width="320" height="170" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-173" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;user function的下一条指令地址&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffcc99;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="1010" y="2901" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-174" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;RIP:&amp;nbsp; &amp;nbsp; 0x40-0x48&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1340" y="2906" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-175" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="1010" y="3181" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-176" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;guard:&amp;nbsp; &amp;nbsp; 0x08-0x10&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1340" y="3186" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-177" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="1010" y="3141" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-178" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R12:&amp;nbsp; &amp;nbsp; 0x10-0x18&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1340" y="3146" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-179" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="1010" y="3101" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-180" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R13:&amp;nbsp; &amp;nbsp; 0x18-0x20&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1340" y="3106" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-181" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="1010" y="3061" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-182" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R14:&amp;nbsp; &amp;nbsp; 0x20-0x28&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1340" y="3066" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-183" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="1010" y="3021" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-184" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R15:&amp;nbsp; &amp;nbsp; 0x28-0x30&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1340" y="3026" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-185" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="1010" y="2981" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-186" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;RBX:&amp;nbsp; &amp;nbsp; 0x30-0x38&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1340" y="2986" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-187" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="1010" y="2941" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-188" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;RBP:&amp;nbsp; &amp;nbsp; 0x38-0x40&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1340" y="2946" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-189" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="1010" y="3221" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-190" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;fc_mxcsr:&amp;nbsp; 0x00-0x04&amp;nbsp; &amp;nbsp; fc_x87_cw: 0x04-0x08&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1340" y="3226" width="290" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-191" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="1170" y="3221" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-192" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;调用jump_fcontext时，call指令push RIP&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="757" y="2901" width="230" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-193" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;jump_fcontext函数内保存寄存器，在main的栈上&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="717" y="3086" width="290" height="30" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-194" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;labelPosition=left;verticalLabelPosition=middle;align=right;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="987" y="2941" width="20" height="320" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-195" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;labelPosition=left;verticalLabelPosition=middle;align=right;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="987" y="2901" width="20" height="40" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-196" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#B3B3B3;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="-27" y="2750" width="320" height="330" as="geometry" />
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-197" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-120" y="2750" as="sourcePoint" />
            <mxPoint x="-30" y="2750" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="KbAcV0jcCkFXwa1uhN9h-198" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;rsp&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-173" y="2734" width="65" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-1" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;rip(下一条指令):&lt;br&gt;&amp;nbsp; &amp;nbsp; jump_context的返回值&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; rax: coroutine的context&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; rdx: coroutine的user data;&lt;br&gt;&lt;/font&gt;" style="shape=ext;double=1;rounded=0;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="313" y="2750" width="230" height="90" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-2" value="" style="endArrow=classic;html=1;rounded=0;entryX=0;entryY=1;entryDx=0;entryDy=0;edgeStyle=orthogonalEdgeStyle;curved=1;" edge="1" parent="1" target="KbAcV0jcCkFXwa1uhN9h-189">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="490" y="2800" as="sourcePoint" />
            <mxPoint x="730" y="2630" as="targetPoint" />
            <Array as="points">
              <mxPoint x="490" y="2801" />
              <mxPoint x="530" y="2801" />
              <mxPoint x="530" y="3260" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-3" value="user-function的返回地址" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="1010" y="1430" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-4" value="user-function的返回地址" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="1010" y="2690" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-7" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;user function使用的栈空间&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=default;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1115" y="2785" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-8" value="&lt;ol&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;main再resume coroutine，和coroutine yield to main非常类似；从user function的角度看，就是jump_fcontext函数返回了，其实经过两次跳转；&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;jump_fcontext中，恢复寄存器，寄存器占的空间还给栈（因为已恢复）；&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;resume到coroutine之后，jump_fcontext的返回值是：&lt;/font&gt;&lt;/li&gt;&lt;ol&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;rax: main栈上的context；&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;rdx: main的user_data;&lt;/font&gt;&lt;/li&gt;&lt;/ol&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;user function继续运行；&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;假如user function不跳回mian，直接运行到返回：&lt;/font&gt;返回后，从finish开始执行，调用_exit，程序退出。&lt;/li&gt;&lt;li&gt;&lt;font face=&quot;Comic Sans MS&quot;&gt;假如user function做完任务跳回main，再不跳回来，那么finish就永远不会执行，程序在main返回时退出。&lt;/font&gt;&lt;/li&gt;&lt;/ol&gt;" style="text;html=1;strokeColor=none;fillColor=#a0522d;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="410" y="3630" width="470" height="210" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-10" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#B3B3B3;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="1030" y="3990" width="320" height="760" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-11" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;finish:&lt;br&gt;&amp;nbsp; &amp;nbsp; xorq&amp;nbsp; %rdi, %rdi&lt;br&gt;&amp;nbsp; &amp;nbsp; call&amp;nbsp; _exit@PLT&lt;br&gt;&amp;nbsp; &amp;nbsp; hlt&lt;br&gt;&lt;/font&gt;" style="shape=ext;double=1;rounded=0;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="780" y="4401" width="230" height="90" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-12" value="" style="endArrow=classic;html=1;rounded=0;edgeStyle=orthogonalEdgeStyle;curved=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="Eoj1K-aATxveumdk1Mle-42" target="Eoj1K-aATxveumdk1Mle-11">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="895.5" y="4310" as="sourcePoint" />
            <mxPoint x="885" y="4440" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-42" value="user-function的返回地址" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="1030" y="3950" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-67" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;main的下一条指令地址&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffcc99;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="13" y="4130" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-68" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;RIP:&amp;nbsp; &amp;nbsp; 0x40-0x48&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="343" y="4135" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-69" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="13" y="4410" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-70" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;guard:&amp;nbsp; &amp;nbsp; 0x08-0x10&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="343" y="4415" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-71" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="13" y="4370" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-72" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R12:&amp;nbsp; &amp;nbsp; 0x10-0x18&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="343" y="4375" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-73" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="13" y="4330" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-74" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R13:&amp;nbsp; &amp;nbsp; 0x18-0x20&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="343" y="4335" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-75" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="13" y="4290" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-76" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R14:&amp;nbsp; &amp;nbsp; 0x20-0x28&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="343" y="4295" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-77" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="13" y="4250" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-78" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;R15:&amp;nbsp; &amp;nbsp; 0x28-0x30&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="343" y="4255" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-79" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;func_ptr&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="13" y="4210" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-80" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;RBX:&amp;nbsp; &amp;nbsp; 0x30-0x38&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="343" y="4215" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-81" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="13" y="4170" width="320" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-82" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;RBP:&amp;nbsp; &amp;nbsp; 0x38-0x40&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="343" y="4175" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-83" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="13" y="4450" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-84" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;fc_mxcsr:&amp;nbsp; 0x00-0x04&amp;nbsp; &amp;nbsp; fc_x87_cw: 0x04-0x08&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="343" y="4455" width="290" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-85" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#36393d;" vertex="1" parent="1">
          <mxGeometry x="173" y="4450" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-86" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;调用jump_fcontext时，call指令push RIP&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-240" y="4130" width="230" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-87" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;jump_fcontext函数内保存寄存器，在main的栈上&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-280" y="4315" width="290" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-88" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;labelPosition=left;verticalLabelPosition=middle;align=right;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="-10" y="4170" width="20" height="320" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-89" value="" style="shape=curlyBracket;whiteSpace=wrap;html=1;rounded=1;labelPosition=left;verticalLabelPosition=middle;align=right;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="-10" y="4130" width="20" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-90" value="" style="rounded=0;whiteSpace=wrap;html=1;fillStyle=dots;" vertex="1" parent="1">
          <mxGeometry x="13" y="4030" width="320" height="100" as="geometry" />
        </mxCell>
        <mxCell id="Eoj1K-aATxveumdk1Mle-92" value="&lt;font face=&quot;Comic Sans MS&quot;&gt;main使用的&lt;br&gt;栈空间&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=default;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="113" y="4058" width="100" height="35" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
